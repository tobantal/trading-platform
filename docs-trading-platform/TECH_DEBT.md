# Технический долг (Technical Debt)

> Последнее обновление: 2025-12-30
> Статус: Все баги перенесены в технический долг для ускорения разработки MVP

## Приоритеты

| Приоритет | Описание |
|-----------|----------|
| P1 | Критично — блокирует работу |
| P2 | Важно — нужно исправить до production |
| P3 | Желательно — улучшит качество кода |
| P4 | Низкий — можно отложить |

---

## TD-001: Сложные хэндлеры (нарушение OCP)

**Приоритет:** P3 → P4 (понижен)  
**Статус:** Технический долг  
**Решение:** Исправлять по мере необходимости

### Описание
Некоторые хэндлеры (`MarketHandler`, `OrderHandler`, `PortfolioHandler`, `StrategyHandler`) являются "контроллерами" — содержат логику для нескольких endpoint-ов через if-else.

### Проблема
Нарушается принцип OCP (Open-Closed Principle). Для добавления нового endpoint нужно модифицировать существующий класс.

### Решение (когда будет время)
Распилить каждый "контроллер" на отдельные хэндлеры:
- `PortfolioHandler` → `GetPortfolioHandler`, `GetPositionsHandler`, `GetCashHandler`
- И так далее...

### Договорённость
- Все НОВЫЕ endpoint-ы реализуем как отдельные хэндлеры
- Существующие "контроллеры" рефакторим только при появлении багов в них

---

## TD-002: Лишние методы в хэндлерах

**Приоритет:** P4  
**Статус:** Технический долг

### Описание
В некоторых хэндлерах есть методы типа `extractPath()`, которые дублируют функциональность `IRequest::getPath()`.

### Решение
При рефакторинге хэндлеров удалять лишние методы.

---

## TD-003: Дублирование данных (DRY)

**Приоритет:** P3  
**Статус:** Технический долг

### Проблемы

1. **Instrument.currency + Money.currency**
   - В `Instrument` есть `std::string currency`
   - В `Money minPriceIncrement` тоже есть `currency`
   - Дублирование может привести к рассинхронизации

2. **OrderRequest.accountId + метод placeOrder(accountId, request)**
   - `accountId` передаётся дважды

### Решение
- Вариант A: Убрать `currency` из `Instrument`, оставить только в `Money`
- Вариант B (выбран): Оставить как есть, но в коде использовать только один источник

---

## TD-004: Дублирование генерации UUID

**Приоритет:** P4  
**Статус:** Частично исправлен

### Описание
В разных местах дублируется код генерации UUID.

### Решение
Создан `include/utils/UuidGenerator.hpp`. Нужно везде использовать его.

---

## TD-005: Неоптимальная реализация кэша ICachePort

**Приоритет:** P3  
**Статус:** Технический долг

### Описание
В `MarketService` кэширование реализовано через сериализацию/десериализацию JSON, хотя можно использовать типизированный LRU cache напрямую.

### Решение (когда будет время)
Создать декоратор `CachedMarketService` поверх `MarketService`:
- `MarketService` — чистая логика без кэша
- `CachedMarketService` — добавляет кэширование

Либо выпилить полностью ICachePort. Кэширование - это внутренняя логика приложений, не уровень порта.

---

## TD-006: Рефакторинг/удаление библиотеки common

**Приоритет:** P3  
**Статус:** Требует реализации

### Описание
Выпилить неиспользуемые классы: `CommandException`, `ICommand`, `IUObject`, `UObject`, `ThreadSafeQueue`.
Отсается на текущий момент только `ThreadSafeMap`. Либо перенести туда, где используется, либо заменить на продвинутый `Cache` из библиотеки cpp-cache.

----

## TD-007: Починить сборку docker в CI

**Приоритет:** P3  
**Статус:** Требует реализации

### Описание
В `/todo/ci-dcoker-need-word.yml` часть `cmake.yml`, которую нужно доработать, чтоб собирался проект из запускались докер контейнеры с приложениями в GitHUb Action.

Добавить интеграционные тесты.

---

## Договорённости

### По новым endpoint-ам
Все новые endpoint-ы реализуем как отдельные хэндлеры (1 класс = 1 endpoint).

### По рефакторингу
Рефакторим существующий код только при:
- Появлении бага в этом коде
- Наличии свободного времени после основных задач

### По приоритетам
- P1, P2 — исправляем до защиты
- P3, P4 — после защиты (или при наличии времени)
