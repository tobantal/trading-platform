docker-build:
    runs-on: ubuntu-latest
    needs: build-and-test
    
    steps:
    - name: üîÑ Checkout
      uses: actions/checkout@v4 

    - name: üîç Debug file structure
      run: |
        echo "=== Current directory structure ==="
        pwd
        ls -la
        echo ""
        echo "=== Looking for Dockerfile ==="
        find . -name "Dockerfile" -type f 2>/dev/null | head -20

    - name: üê≥ Build Docker image
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è Dockerfile –∏ –º–µ–Ω—è–µ–º –≤ –Ω–µ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        if [ -f "Dockerfile" ]; then
          echo "Building from root Dockerfile"
          docker build -t trading-mvp:test .
        elif [ -f "mvp/Dockerfile" ]; then
          echo "Building from mvp/Dockerfile"
          cd mvp
          docker build -t trading-mvp:test .
        elif [ -f "docker/Dockerfile" ]; then
          echo "Building from docker/Dockerfile"
          cd docker
          docker build -t trading-mvp:test .
        else
          echo "ERROR: Dockerfile not found!"
          echo "Current directory contents:"
          ls -la
          echo "Searching for Dockerfile..."
          find . -name "Dockerfile" -type f 2>/dev/null
          exit 1
        fi
      
    - name: üè• Test health endpoint
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –æ–±—Ä–∞–∑ —Å–æ–∑–¥–∞–ª—Å—è
        if ! docker images trading-mvp:test -q | grep -q .; then
          echo "Docker image not built, skipping health check"
          exit 0
        fi
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        docker run -d --name trading-test -p 8080:8080 trading-mvp:test
        
        # –ñ–¥—ë–º —Å—Ç–∞—Ä—Ç–∞
        sleep 10
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º health
        curl -f http://localhost:8080/api/v1/health || exit 1
        
        # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
        docker stop trading-test
        docker rm trading-test
